//
// Copyright Kamil PÄ™kala http://github.com/kamilkp
// Angular Virtual Scroll Repeat v1.1.7 2016/03/08
//

!function(e,t){"use strict";function n(){if("pageYOffset"in e)return{scrollTop:pageYOffset,scrollLeft:pageXOffset};var t,n,s=document,r=s.documentElement,o=s.body;return t=r.scrollLeft||o.scrollLeft||0,n=r.scrollTop||o.scrollTop||0,{scrollTop:n,scrollLeft:t}}function s(t,n){return t===e?"clientWidth"===n?e.innerWidth:e.innerHeight:t[n]}function r(t,s){return t===e?n()[s]:t[s]}function o(t,s,r){return t.getBoundingClientRect()[r?"left":"top"]-(s===e?0:s.getBoundingClientRect()[r?"left":"top"])+(s===e?n():s)[r?"scrollLeft":"scrollTop"]}var a=document.documentElement,i=a.matches?"matches":a.matchesSelector?"matchesSelector":a.webkitMatches?"webkitMatches":a.webkitMatchesSelector?"webkitMatchesSelector":a.msMatches?"msMatches":a.msMatchesSelector?"msMatchesSelector":a.mozMatches?"mozMatches":a.mozMatchesSelector?"mozMatchesSelector":null,l=t.element.prototype.closest||function(e){for(var n=this[0].parentNode;n!==document.documentElement&&null!=n&&!n[i](e);)n=n.parentNode;return n&&n[i](e)?t.element(n):t.element()},c=t.module("vs-repeat",[]).directive("vsRepeat",["$compile","$parse",function(n,a){return{restrict:"A",scope:!0,compile:function(i,c){var f,d,u,p,v,h,m=t.isDefined(c.vsRepeatContainer)?t.element(i[0].querySelector(c.vsRepeatContainer)):i,g=m.children().eq(0),x=g[0].outerHTML,$="$vs_collection",S=!1,z={vsRepeat:"elementSize",vsOffsetBefore:"offsetBefore",vsOffsetAfter:"offsetAfter",vsScrolledToEndOffset:"scrolledToEndOffset",vsScrolledToBeginningOffset:"scrolledToBeginningOffset",vsExcess:"excess"};if(g.attr("ng-repeat"))h="ng-repeat",f=g.attr("ng-repeat");else if(g.attr("data-ng-repeat"))h="data-ng-repeat",f=g.attr("data-ng-repeat");else if(g.attr("ng-repeat-start"))S=!0,h="ng-repeat-start",f=g.attr("ng-repeat-start");else{if(!g.attr("data-ng-repeat-start"))throw new Error("angular-vs-repeat: no ng-repeat directive on a child element");S=!0,h="data-ng-repeat-start",f=g.attr("data-ng-repeat-start")}if(d=/^\s*(\S+)\s+in\s+([\S\s]+?)(track\s+by\s+\S+)?$/.exec(f),u=d[1],p=d[2],v=d[3],S)for(var I=0,M=m.children().eq(0);null==M.attr("ng-repeat-end")&&null==M.attr("data-ng-repeat-end");)I++,M=m.children().eq(I),x+=M[0].outerHTML;return m.empty(),{pre:function(i,c,f){function d(){if(!E||E.length<1)i[$]=[],C=0,i.sizesCumulative=[0];else if(C=E.length,q){i.sizes=E.map(function(e){var n=i.$new(!1);t.extend(n,e),n[u]=e;var s=f.vsSize||f.vsSizeProperty?n.$eval(f.vsSize||f.vsSizeProperty):i.elementSize;return n.$destroy(),s});var e=0;i.sizesCumulative=i.sizes.map(function(t){var n=e;return e+=t,n}),i.sizesCumulative.push(e)}else m();w()}function m(){P&&i.$$postDigest(function(){if(R[0].offsetHeight||R[0].offsetWidth){for(var e=R.children(),t=0,n=!1,s=!1;t<e.length;){if(null!=e[t].attributes[h]||s){if(n||(i.elementSize=0),n=!0,e[t][N]&&(i.elementSize+=e[t][N]),!S)break;if(null!=e[t].attributes["ng-repeat-end"]||null!=e[t].attributes["data-ng-repeat-end"])break;s=!0}t++}n&&(w(),P=!1,i.$root&&!i.$root.$$phase&&i.$apply())}else var r=i.$watch(function(){(R[0].offsetHeight||R[0].offsetWidth)&&(r(),m())})})}function g(){var e="tr"===O?"":"min-";return A?e+"width":e+"height"}function I(){b()&&i.$digest()}function M(){void 0!==f.vsAutoresize&&(P=!0,m(),i.$root&&!i.$root.$$phase&&i.$apply()),b()&&i.$apply()}function w(){Y=void 0,j=void 0,U=C,X=0,y(q?i.sizesCumulative[C]:i.elementSize*C),b(),i.$emit("vsRepeatReinitialized",i.startIndex,i.endIndex)}function y(e){i.totalSize=i.offsetBefore+e+i.offsetAfter}function T(){var e=s(H[0],D);e!==_&&(w(),i.$root&&!i.$root.$$phase&&i.$apply()),_=e}function b(){var e=r(H[0],F),t=s(H[0],D),n=R[0]===H[0]?0:o(R[0],H[0],A),l=i.startIndex,c=i.endIndex;if(q){for(l=0;i.sizesCumulative[l]<e-i.offsetBefore-n;)l++;for(l>0&&l--,c=l=Math.max(Math.floor(l-i.excess/2),0);i.sizesCumulative[c]<e-i.offsetBefore-n+t;)c++;c=Math.min(Math.ceil(c+i.excess/2),C)}else l=Math.max(Math.floor((e-i.offsetBefore-n)/i.elementSize)-i.excess/2,0),c=Math.min(l+Math.ceil(t/i.elementSize)+i.excess,C);U=Math.min(l,U),X=Math.max(c,X),i.startIndex=W.latch?U:l,i.endIndex=W.latch?X:c;var d=!1;if(null==Y?d=!0:null==j&&(d=!0),d||(W.hunked?Math.abs(i.startIndex-Y)>=i.excess/2||0===i.startIndex&&0!==Y?d=!0:(Math.abs(i.endIndex-j)>=i.excess/2||i.endIndex===C&&j!==C)&&(d=!0):d=i.startIndex!==Y||i.endIndex!==j),d){i[$]=E.slice(i.startIndex,i.endIndex),i.$emit("vsRepeatInnerCollectionUpdated",i.startIndex,i.endIndex,Y,j);var u;f.vsScrolledToEnd&&(u=E.length-(i.scrolledToEndOffset||0),(i.endIndex>=u&&j<u||E.length&&i.endIndex===E.length)&&i.$eval(f.vsScrolledToEnd)),f.vsScrolledToBeginning&&(u=i.scrolledToBeginningOffset||0,i.startIndex<=u&&Y>i.startIndex&&i.$eval(f.vsScrolledToBeginning)),Y=i.startIndex,j=i.endIndex;var p=a(q?"(sizesCumulative[$index + startIndex] + offsetBefore)":"(($index + startIndex) * elementSize + offsetBefore)"),v=p(i,{$index:0}),h=p(i,{$index:i[$].length}),m=i.totalSize;k.css(g(),(v>0?v:"0")+"px"),L.css(g(),(m-h>0?m-h:"0")+"px")}return d}var C,R=t.isDefined(f.vsRepeatContainer)?t.element(c[0].querySelector(f.vsRepeatContainer)):c,B=t.element(x),O=B[0].tagName.toLowerCase(),E=[],A=void 0!==f.vsHorizontal,k=t.element("<"+O+' class="vs-repeat-before-content"></'+O+">"),L=t.element("<"+O+' class="vs-repeat-after-content"></'+O+">"),P=!f.vsRepeat,q=!!f.vsSize||!!f.vsSizeProperty,H=f.vsScrollParent?"window"===f.vsScrollParent?t.element(e):l.call(R,f.vsScrollParent):R,W="vsOptions"in f?i.$eval(f.vsOptions):{},D=A?"clientWidth":"clientHeight",N=A?"offsetWidth":"offsetHeight",F=A?"scrollLeft":"scrollTop";if(i.totalSize=0,!("vsSize"in f)&&"vsSizeProperty"in f&&console.warn("vs-size-property attribute is deprecated. Please use vs-size attribute which also accepts angular expressions."),0===H.length)throw"Specified scroll parent selector did not match any element";i.$scrollParent=H,q&&(i.sizesCumulative=[]),i.elementSize=+f.vsRepeat||s(H[0],D)||50,i.offsetBefore=0,i.offsetAfter=0,i.excess=2,A?(k.css("height","100%"),L.css("height","100%")):(k.css("width","100%"),L.css("width","100%")),Object.keys(z).forEach(function(e){f[e]&&f.$observe(e,function(t){i[z[e]]=+t,w()})}),i.$watchCollection(p,function(e){E=e||[],d()}),B.eq(0).attr(h,u+" in "+$+(v?" "+v:"")),B.addClass("vs-repeat-repeated-element"),R.append(k),R.append(B),n(B)(i),R.append(L),i.startIndex=0,i.endIndex=0,H.on("scroll",I),t.element(e).on("resize",M),i.$on("$destroy",function(){t.element(e).off("resize",M),H.off("scroll",I)}),i.$on("vsRepeatTrigger",d),i.$on("vsRepeatResize",function(){P=!0,m()});var Y,j,U,X;i.$on("vsRenderAll",function(){W.latch&&setTimeout(function(){var e=C;X=Math.max(e,X),i.endIndex=W.latch?X:e,i[$]=E.slice(i.startIndex,i.endIndex),j=i.endIndex,i.$$postDigest(function(){k.css(g(),0),L.css(g(),0)}),i.$apply(function(){i.$emit("vsRenderAllDone")})})});var _;i.$watch(function(){"function"==typeof e.requestAnimationFrame?e.requestAnimationFrame(T):T()})}}}}}]);"undefined"!=typeof module&&module.exports&&(module.exports=c.name)}(window,window.angular);